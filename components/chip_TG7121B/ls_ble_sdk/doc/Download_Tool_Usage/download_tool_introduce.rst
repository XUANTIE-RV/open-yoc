================
在线烧录工具使用
================
------------------
一、 烧录工具获取
------------------

 :download:`ls_download_tool<./ls_download_tool.7z>`

++++++++++++
1.1 文件说明
++++++++++++

压缩包内包含两个文件夹，``DownloadTool`` 内工具用于下载用户Image到芯片内，``Excel2BinTool`` 内工具将天猫精灵工程所用的三元组的Excel文件转化成二进制文件，打开对应的.exe文件即可使用相关工具。

----------------
二、 操作说明
----------------

++++++++++++++++++++++++
2.1 config.ini 文件配置
++++++++++++++++++++++++

``DownloadTool\config.ini`` 文件主要用于下载之前的一些配置

>>>>>>>>>>>>>>>>>>>>>>>>>
2.1.1 蓝牙地址生成模式
>>>>>>>>>>>>>>>>>>>>>>>>>

[ADDRESS]: 配置蓝牙的设备地址，烧录到flash的地址可以通过WRITE_FLASH_ADDR配置，``RANDOM=0`` 时，MAC地址可以滚码烧录，起始地址为START_ADDRESS的值，``RANDOM=1`` 时，烧录的地址为随机地址。只有在烧录界面勾选了蓝牙地址选项该项配置才会生效。第一次打开烧录软件时，会在 program 和 FlashDownload_Addr 目录下生成一个保存有 1600个 MAC 地址的 address.csv 文件。 如果修改了 config.ini 文件中地址生成方式， 需要关闭烧录软件， 将这两个目录删除， 重新打开才可生成新的地址文件。如果不选择烧录MAC地址，代码中也会分配一个随机地址。

>>>>>>>>>>>>>>>>>>>>>>>>>
2.1.2 串口黑名单
>>>>>>>>>>>>>>>>>>>>>>>>>

[COM]: 配置过滤串口选项，当电脑中存在不是用来烧录的串口时可将其配置到黑名单中，这样烧录软件扫描串口时则会自动忽略该串口， 不会在烧录界面占用一个位置。例如：把 COM8和COM10禁掉, COM_BLACKLIST=8,10

>>>>>>>>>>>>>>>>>>>>>>>>>
2.1.3 下载配置
>>>>>>>>>>>>>>>>>>>>>>>>>

[DOWNLOAD]: 配置默认波特率和是否需要下载MAC地址，``BAUDRATE=6`` 表示默认波特率为460800; ``BLE_ADDR=0`` 时，表示启动烧录软件默认不烧录MAC地址，``BLE_ADDR=1`` 时，默认选择烧录MAC地址。

++++++++++++
2.2 下载操作
++++++++++++
#. 断开所有连线，将uart串口工具的RXD Pin接芯片的PB00,TXD Pin接芯片的PB01,3.3V接芯片的VDD，GND接GND，再将芯片的PB14拉高；

#. 将串口工具连接电脑给芯片上电，必须在第一步的接线完成之后再给芯片上电；

#. 打开download.exe，选择固件，导入要下载的hex文件，如果不是天猫精灵的工程，则不需要导入三元码文件，对于天猫精灵的工程需要先将三元组的Excel文件通过Excel2Bin工具转换成bin文件，然后导入到三元码对应的选项框；

#. 下载工具界面选择相应的COM口，默认波特率为460800，也可改成其它，如果下载过程中一直出现校验出错的情况，可以降低波特率重新烧录；

#. 点击打开按钮，打开相应的COM口；

#. 烧录成功之后，下载的进度条为100%，下载状态显示下载完成；

#. 如果烧录失败，在串口工具不掉电的情况下，重新给芯片上电，或者通过拉低NRST pin复位芯片，上位机烧录软件不需要操作；在烧录软件打开串口后，串口工具意外断电，烧录软件上需要关闭串口后再重新打开串口；

#. 去掉PB14的拉高，重新上电或复位便可运行烧录的程序。

**注：**
芯片刚启动的时候BootRom中会去检测PB14的状态，如果处于拉高，则会进入到UART Download Mode，否则会去运行用户程序；下载的时候会首先对flash做一次全擦除操作，每烧录256字节都会做CRC校验，只有检验通过才会继续烧入，直到烧录完成.